<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WolvCapital Invest{% endblock %}</title>
    <meta name="description" content="{% block description %}WolvCapital offers professional investment opportunities with manual off-chain approvals for maximum security.{% endblock %}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Brand CSS -->
    <link rel="stylesheet" href="{% static 'css/brand.css' %}">

    <!-- Custom CSS -->
    <style>
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .text-gradient { background: linear-gradient(135deg, #1e3a8a, #3b82f6); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; color: transparent; }
        
        /* Chat Widget Styles */
        .chat-pulse {
            animation: chat-pulse 2s infinite;
        }
        
        @keyframes chat-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        
        .chat-show {
            opacity: 1 !important;
            transform: scale(1) !important;
        }
        
        #chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        #chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }
        
        .message-bubble {
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .quick-action-btn:hover {
            transform: translateY(-1px);
        }
        
        /* Mobile responsive */
        @media (max-width: 640px) {
            #chat-window {
                width: calc(100vw - 3rem);
                right: 1.5rem;
                left: 1.5rem;
            }
        }
    </style>
    
    {% block extra_css %}{% endblock %}
    </head>
<body>
    <!-- Navbar -->
    <header class="navbar">
        <div style="display:flex;align-items:center;gap:.75rem;">
            <img src="{% static 'img/wolvcapital-invest-logo.svg' %}" alt="logo">
            <strong>WOLVCAPITAL INVEST</strong>
        </div>
        <nav>
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'plans' %}">Plans</a>
            <a href="{% url 'dashboard' %}">Dashboard</a>
            {% if user.is_authenticated %}
                <a href="{% url 'account_logout' %}">Logout</a>
            {% else %}
                <a href="{% url 'account_login' %}">Login</a>
            {% endif %}
        </nav>
    </header>

    <!-- Messages -->
    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mb-4 p-4 rounded-md {% if message.tags == 'error' %}bg-red-100 border border-red-400 text-red-700{% elif message.tags == 'warning' %}bg-yellow-100 border border-yellow-400 text-yellow-700{% elif message.tags == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-blue-100 border border-blue-400 text-blue-700{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>

    <!-- Customer Support Chat Widget -->
    <div id="chat-widget" class="fixed bottom-6 right-6 z-50" style="display:none;">
        <!-- Chat Button -->
        <button id="chat-button" title="Open customer support chat" aria-label="Open customer support chat" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-16 h-16 shadow-lg transition-all duration-300 transform hover:scale-110 flex items-center justify-center chat-pulse">
            <svg id="chat-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>

        <!-- Chat Window -->
        <div id="chat-window" class="absolute bottom-20 right-0 w-80 h-96 bg-white rounded-lg shadow-2xl border border-gray-200 hidden transform transition-all duration-300 opacity-0 scale-95">
            <!-- Chat Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold">WolvCapital Support</h3>
                            <p class="text-sm text-blue-100">Online â€¢ Typically replies instantly</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chat-messages" class="h-64 p-4 overflow-y-auto bg-gray-50">
                <div class="space-y-3">
                    <!-- Welcome Message -->
                    <div class="flex items-start space-x-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs">
                            <p class="text-sm text-gray-800">ðŸ‘‹ Hello! Welcome to WolvCapital. How can I help you today?</p>
                            <div class="text-xs text-gray-500 mt-1">Just now</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="p-3 border-t border-gray-200 bg-white">
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <button class="quick-action-btn text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 p-2 rounded-md transition-colors duration-200" data-message="I need help with deposits">
                        <!-- Footer -->
                        <footer style="text-align:center;padding:2rem;color:#555;">
                            Â© 2025 WOLVCAPITAL INVEST. All rights reserved.
                        </footer>
                <div>
                    <h4 class="text-md font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="{% url 'home' %}" class="hover:text-white">Home</a></li>
                        <li><a href="{% url 'plans' %}" class="hover:text-white">Investment Plans</a></li>
                        <li><a href="{% url 'about' %}" class="hover:text-white">About Us</a></li>
                        <li><a href="{% url 'contact' %}" class="hover:text-white">Contact</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Legal</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="{% url 'terms_of_service' %}" class="hover:text-white">Terms of Service</a></li>
                        <li><a href="{% url 'terms' %}" class="hover:text-white">Legal Disclaimer</a></li>
                        <li><a href="{% url 'risk_disclosure' %}" class="hover:text-white">Risk Disclosure</a></li>
                        <li><a href="{% url 'privacy' %}" class="hover:text-white">Privacy Policy</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Contact Info</h4>
                    <div class="text-gray-300 space-y-2">
                        <p>Email: support@wolvcapital.com</p>
                        <p>Phone: +1 (555) 123-4567</p>
                        <p>24/7 Customer Support</p>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-300">
                <p>&copy; 2024 WolvCapital. All rights reserved.</p>
            </div>
        </div>
    </footer>

    {% block extra_js %}
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Chat Widget Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatButton = document.getElementById('chat-button');
            const chatWindow = document.getElementById('chat-window');
            const chatIcon = document.getElementById('chat-icon');
            const closeIcon = document.getElementById('close-icon');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const chatMessages = document.getElementById('chat-messages');
            const quickActionBtns = document.querySelectorAll('.quick-action-btn');

            let isOpen = false;

            // Toggle chat window
            function toggleChat() {
                isOpen = !isOpen;
                if (isOpen) {
                    chatWindow.classList.remove('hidden');
                    setTimeout(() => {
                        chatWindow.classList.add('chat-show');
                    }, 10);
                    chatIcon.classList.add('hidden');
                    closeIcon.classList.remove('hidden');
                    chatButton.classList.remove('chat-pulse');
                    chatInput.focus();
                } else {
                    chatWindow.classList.remove('chat-show');
                    setTimeout(() => {
                        chatWindow.classList.add('hidden');
                    }, 300);
                    chatIcon.classList.remove('hidden');
                    closeIcon.classList.add('hidden');
                    chatButton.classList.add('chat-pulse');
                }
            }

            // Add message to chat
            function addMessage(message, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-2 message-bubble' + (isUser ? ' flex-row-reverse space-x-reverse' : '');
                
                const avatar = document.createElement('div');
                avatar.className = 'w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0';
                
                if (isUser) {
                    avatar.className += ' bg-blue-500';
                    avatar.innerHTML = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>';
                } else {
                    avatar.className += ' bg-blue-600';
                    avatar.innerHTML = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>';
                }

                const messageBubble = document.createElement('div');
                messageBubble.className = 'p-3 rounded-lg shadow-sm max-w-xs';
                messageBubble.className += isUser ? ' bg-blue-600 text-white' : ' bg-white';
                
                const messageText = document.createElement('p');
                messageText.className = 'text-sm';
                messageText.className += isUser ? ' text-white' : ' text-gray-800';
                messageText.textContent = message;

                const timestamp = document.createElement('div');
                timestamp.className = 'text-xs mt-1';
                timestamp.className += isUser ? ' text-blue-100' : ' text-gray-500';
                timestamp.textContent = 'Just now';

                messageBubble.appendChild(messageText);
                messageBubble.appendChild(timestamp);
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageBubble);

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Simulate support response
            function getAutoResponse(userMessage) {
                const lowerMessage = userMessage.toLowerCase();
                
                if (lowerMessage.includes('deposit') || lowerMessage.includes('funding')) {
                    return "Thanks for your question about deposits! We support bank transfers and multiple cryptocurrencies (BTC, USDT, USDC, ETH). All deposits are manually reviewed for security. How can I help you with your deposit?";
                } else if (lowerMessage.includes('withdrawal') || lowerMessage.includes('withdraw')) {
                    return "I can help you with withdrawals! Withdrawal requests are processed manually within 24 hours. Please ensure your account is verified and you have sufficient balance. What specific help do you need?";
                } else if (lowerMessage.includes('investment') || lowerMessage.includes('plan')) {
                    return "Great question about our investment plans! We offer 4 plans: Pioneer (1% daily), Vanguard (1.25% daily), Horizon (1.5% daily), and Summit (2% daily). All investments require manual approval. Which plan interests you?";
                } else if (lowerMessage.includes('account') || lowerMessage.includes('login') || lowerMessage.includes('password')) {
                    return "I can help with account issues! For password resets, use the 'Forgot Password' link on the login page. For other account issues, please provide more details about the problem you're experiencing.";
                } else if (lowerMessage.includes('card') || lowerMessage.includes('virtual')) {
                    return "Our Virtual Visa Cards are a premium feature! Cards are available for qualified investors and require admin approval. They come with global payment capabilities and enhanced security. Would you like more information?";
                } else if (lowerMessage.includes('help') || lowerMessage.includes('support')) {
                    return "I'm here to help! I can assist with deposits, withdrawals, investments, account issues, and virtual cards. What specific topic would you like help with?";
                } else {
                    return "Thank you for your message! Our support team will review your inquiry and respond shortly. For urgent matters, you can also email us at support@wolvcapital.com or call +1 (555) 123-4567.";
                }
            }

            // Send message
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    chatInput.value = '';
                    
                    // Simulate typing delay
                    setTimeout(() => {
                        const response = getAutoResponse(message);
                        addMessage(response, false);
                    }, 1000 + Math.random() * 2000);
                }
            }

            // Event listeners
            chatButton.addEventListener('click', toggleChat);
            sendButton.addEventListener('click', sendMessage);
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Quick action buttons
            quickActionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const message = this.getAttribute('data-message');
                    addMessage(message, true);
                    
                    setTimeout(() => {
                        const response = getAutoResponse(message);
                        addMessage(response, false);
                    }, 800);
                });
            });

            // Show notification after delay
            setTimeout(() => {
                if (!isOpen) {
                    chatButton.classList.add('chat-pulse');
                }
            }, 5000);
        });
    </script>
    {% endblock %}
</body>
</html>